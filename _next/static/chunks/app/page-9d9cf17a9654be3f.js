(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4932:(e,t,a)=>{"use strict";a.d(t,{default:()=>J});var s=a(5155),r=a(5695),o=a(2115),l=a(3915),n=a(1115);let i=(0,l.Dk)().length?(0,l.Dk)()[0]:(0,l.Wp)({apiKey:"AIzaSyCIEneI8y4NZSGE5AmCaVbOsHw7oy3nCBQ",authDomain:"poll-app-e3560.firebaseapp.com",databaseURL:"https://poll-app-e3560-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"poll-app-e3560",storageBucket:"poll-app-e3560.firebasestorage.app",messagingSenderId:"369998885005",appId:"1:369998885005:web:7fb3c89e5294ae6d56b2c4"}),c=(0,n.C3)(i);var d=a(9708),m=a(2085),u=a(2596),x=a(9688);function p(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,x.QP)((0,u.$)(t))}let h=(0,m.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function f(e){let{className:t,variant:a,size:r,asChild:o=!1,...l}=e,n=o?d.DX:"button";return(0,s.jsx)(n,{"data-slot":"button",className:p(h({variant:a,size:r,className:t})),...l})}function v(e){let{className:t,type:a,...r}=e;return(0,s.jsx)("input",{type:a,"data-slot":"input",className:p("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...r})}function g(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card",className:p("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}var j=a(968);function b(e){let{className:t,...a}=e;return(0,s.jsx)(j.b,{"data-slot":"label",className:p("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...a})}var y=a(7383),w=a(2919);let N=["1","2","3","5","8","11","13"],k=()=>{let e=(0,r.useSearchParams)().get("room")||"",t=(0,r.useRouter)(),a=y.A.get("poker_name"),l=y.A.get("poker_role"),[i,d]=(0,o.useState)(""),[m,u]=(0,o.useState)(""),[x,p]=(0,o.useState)(""),[h,j]=(0,o.useState)([]),[k,C]=(0,o.useState)({}),[R,K]=(0,o.useState)(!1),[A,S]=(0,o.useState)(N),[_,E]=(0,o.useState)(""),[Z,D]=(0,o.useState)(!1),[z,P]=(0,o.useState)(!1),[J,I]=(0,o.useState)(!1),[F,O]=(0,o.useState)(null),[V,q]=(0,o.useState)(!1),[T,B]=(0,o.useState)(""),[L,Q]=(0,o.useState)(""),U=(0,o.useCallback)(async()=>{let a=(0,n.KR)(c,"rooms/".concat(e)),s=(0,n.KR)(c,"rooms/".concat(e,"/members"));if(z){let t=(await (0,n.Jt)(s)).val();if(t){let a=Object.keys(t);await Promise.all(a.map(t=>(0,n.TF)((0,n.KR)(c,"rooms/".concat(e,"/members/").concat(t)))))}await (0,n.TF)(a)}else await (0,n.TF)((0,n.KR)(c,"rooms/".concat(e,"/members/").concat(i)));y.A.remove("poker_name"),y.A.remove("poker_room"),y.A.remove("poker_role"),t.replace("/")},[e,i,z,t]),W=(0,o.useCallback)(async()=>{if(!e)return;let t=(0,n.KR)(c,"rooms/".concat(e));if(!(await (0,n.Jt)(t)).exists()){alert("Room does not exist"),U();return}},[e,U]),X=async()=>{if(W(),!i.trim()||!e)return;let t=(0,n.KR)(c,"rooms/".concat(e,"/members/").concat(i));if((await (0,n.Jt)(t)).exists())return void alert("This name is already in use. Please choose another one.");await (0,n.hZ)(t,!0),y.A.set("poker_name",i),y.A.set("poker_room",e),y.A.set("poker_role","member"),D(!0)},G=async t=>{W(),i&&e&&!R&&(await (0,n.hZ)((0,n.KR)(c,"rooms/".concat(e,"/votes/").concat(i)),t),p(t))},H=async t=>{W(),u(t),await (0,n.hZ)((0,n.KR)(c,"rooms/".concat(e,"/question")),t)},M=async()=>{W(),await (0,n.hZ)((0,n.KR)(c,"rooms/".concat(e,"/revealed")),!0)},Y=async()=>{W(),await (0,n.yo)((0,n.KR)(c,"rooms/".concat(e)),{votes:null,revealed:!1})},$=async t=>{W(),e&&z&&t!==i&&await (0,n.TF)((0,n.KR)(c,"rooms/".concat(e,"/members/").concat(t)))},ee=async()=>{W();let t=_.split(",").map(e=>e.trim()).filter(Boolean);t.length>0&&await (0,n.yo)((0,n.KR)(c,"rooms/".concat(e)),{cardValues:t}).then(()=>E(""))},et=async()=>{if(W(),!e)return;let t=T.trim();await (0,n.yo)((0,n.KR)(c,"rooms/".concat(e)),{password:t||null}),q(!1),B(""),""==T&&O(null)};return(0,o.useEffect)(()=>{W()},[e,t,W]),(0,o.useEffect)(()=>{a&&d(a),"creator"===l&&P(!0),a&&l&&D(!0)},[a,l]),(0,o.useEffect)(()=>{if(!e)return;let t=(0,n.KR)(c,"rooms/".concat(e,"/members")),a=(0,n.KR)(c,"rooms/".concat(e,"/votes")),s=(0,n.KR)(c,"rooms/".concat(e,"/revealed")),r=(0,n.KR)(c,"rooms/".concat(e,"/question")),o=(0,n.KR)(c,"rooms/".concat(e,"/cardValues")),l=(0,n.KR)(c,"rooms/".concat(e,"/password"));if((0,n.Zy)(t,e=>{j(Object.keys(e.val()||{}))}),(0,n.Zy)(a,e=>{C(e.val()||{})}),(0,n.Zy)(s,e=>{K(!!e.val())}),(0,n.Zy)(r,e=>{u(e.val()||"")}),(0,n.Zy)(o,e=>{let t=e.val();t&&Array.isArray(t)?S(t):S(N)}),(0,n.Zy)(l,e=>{let t=e.val();O(null!=t?t:null)}),i){let t=(0,n.KR)(c,"rooms/".concat(e,"/creator"));(0,n.Jt)(t).then(e=>{e.exists()&&e.val()===i&&(P(!0),y.A.set("poker_role","creator"),D(!0))})}},[e,i]),(0,o.useEffect)(()=>{R||!i||k[i]||p("")},[R,k,i]),(0,o.useEffect)(()=>{if(!e||!i||!Z)return;let a=(0,n.KR)(c,"rooms/".concat(e,"/members/").concat(i)),s=(0,n.Zy)(a,e=>{e.exists()||(y.A.remove("poker_name"),y.A.remove("poker_room"),y.A.remove("poker_role"),t.replace("/"))});return()=>s()},[e,i,Z,t]),(0,o.useEffect)(()=>{if(!e)return;let t=(0,n.KR)(c,"rooms/".concat(e,"/members")),a=(0,n.KR)(c,"rooms/".concat(e,"/votes")),s=(0,n.KR)(c,"rooms/".concat(e,"/revealed")),r=(0,n.KR)(c,"rooms/".concat(e,"/question")),o=(0,n.KR)(c,"rooms/".concat(e,"/cardValues"));if((0,n.Zy)(t,e=>{j(Object.keys(e.val()||{}))}),(0,n.Zy)(a,e=>{C(e.val()||{})}),(0,n.Zy)(s,e=>{K(!!e.val())}),(0,n.Zy)(r,e=>{u(e.val()||"")}),(0,n.Zy)(o,e=>{let t=e.val();t&&Array.isArray(t)?S(t):S(N)}),i){let t=(0,n.KR)(c,"rooms/".concat(e,"/creator"));(0,n.Jt)(t).then(e=>{e.exists()&&e.val()===i&&(P(!0),y.A.set("poker_role","creator"),D(!0))})}},[e,i]),(0,o.useEffect)(()=>{if(!e)return;let t=(0,n.KR)(c,"rooms/".concat(e,"/roomName"));(0,n.Zy)(t,e=>{Q(e.val()||"")})},[e]),(0,s.jsx)("div",{children:(0,s.jsxs)(g,{className:"p-6 space-y-4 w-[90vw] mx-auto",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h2",{className:"font-bold text-lg flex gap-3 items-center",children:["Room: ",L," (",e,")"]}),(0,s.jsxs)("h2",{className:"font-bold text-lg flex gap-3 items-center",children:["Password:"," ",V?(0,s.jsxs)("div",{className:"flex gap-2 items-center font-medium text-sm",children:[(0,s.jsx)(v,{type:"text",value:T,onChange:e=>B(e.target.value),placeholder:"New Password",className:"w-[150px]"}),(0,s.jsx)(f,{onClick:et,className:"px-3 py-1 text-xs",variant:"default",children:"Save"}),(0,s.jsx)(f,{onClick:()=>{q(!1),B("")},className:"px-3 py-1 text-xs",variant:"outline",children:"Cancel"})]}):(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[F?(0,s.jsxs)("span",{className:"",children:[F," ",(0,s.jsx)(w.A,{className:"inline",width:12})]}):"-",z&&(0,s.jsx)(f,{onClick:()=>q(!0),size:"sm",variant:"ghost",className:"text-xs px-2 ",children:"Edit"}),z&&F&&(0,s.jsx)(f,{onClick:async()=>{await (0,n.yo)((0,n.KR)(c,"rooms/".concat(e)),{password:null}),O(null)},size:"sm",variant:"destructive",className:"text-xs px-2",children:"Delete"})]})]})]}),(0,s.jsx)(f,{onClick:U,variant:"destructive",className:"cursor-pointer",children:"Quit Room"})]}),(0,s.jsx)("h4",{className:"font-semibold mt-2",children:z?"Admin":i})]}),z&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(b,{children:"Poll Title"}),(0,s.jsx)(v,{placeholder:"Enter poll title",value:m,onChange:e=>H(e.target.value),className:"mb-0"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(b,{htmlFor:"cards",children:"Cards"}),J?(0,s.jsxs)("div",{className:"flex w-full items-center gap-2",children:[(0,s.jsx)(v,{id:"cards",value:_,defaultValue:A.join(", "),onChange:e=>E(e.target.value),placeholder:"e.g. 1,2,3,5,8,13",className:"grow"}),(0,s.jsx)(f,{onClick:()=>{Y(),ee(),I(!1)},className:"min-w-[200px]",children:"Update Cards"})]}):(0,s.jsxs)("div",{className:"flex w-full items-center gap-2",children:[(0,s.jsx)(v,{value:A.join(", "),className:"grow disabled:text-foreground",disabled:!0}),(0,s.jsx)(f,{onClick:()=>I(!0),className:"min-w-[200px]",children:"Edit Card"})]})]})]}),(0,s.jsx)("div",{children:R?(0,s.jsx)(f,{variant:"secondary",className:"w-full cursor-pointer",onClick:Y,children:"Reset"}):(0,s.jsx)(f,{onClick:M,disabled:0===Object.keys(k).length,className:"w-full cursor-pointer",children:"Reveal"})})]}),!Z&&!z&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(b,{htmlFor:"name",children:"Your Name"}),(0,s.jsx)(v,{id:"name",value:i,onChange:e=>d(e.target.value),onKeyDown:e=>{"Enter"===e.key&&i.trim()&&X()},placeholder:"Enter your name"}),(0,s.jsx)(f,{className:"mt-2",onClick:X,disabled:!i.trim(),children:"Join Room"})]}),!z&&m&&(0,s.jsxs)("p",{className:"text-muted-foreground font-bold text-3xl",children:["\uD83D\uDCCC ",m]}),Z&&!z&&!R&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Select your card (you can change before reveal):"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:A.map(e=>(0,s.jsx)(f,{variant:k[i]===e?"default":"outline",onClick:()=>G(e),className:"cursor-pointer w-[75px] h-auto aspect-[3/4]",children:e},e))})]}),x&&!R&&(0,s.jsxs)("p",{className:"text-green-700 font-medium",children:["✅ Vote recorded as ",(0,s.jsx)("strong",{children:x})]}),(0,s.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,s.jsx)("h3",{className:"font-semibold",children:"Members"}),0===h.length?(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"No members yet"}):(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:h.map(e=>(0,s.jsxs)(g,{className:"relative",children:[z&&e!==i&&(0,s.jsx)(f,{variant:"destructive",className:"p-0 w-[20px] h-[20px] text-[10px] absolute right-2 top-2 cursor-pointer","aria-label":"Kick ".concat(e),onClick:()=>$(e),children:"X"}),(0,s.jsx)("h4",{className:"text-center font-semibold",children:e}),(0,s.jsx)("div",{className:"w-full min-h-[7rem] flex items-center justify-center",children:R&&k[e]?(0,s.jsx)("span",{className:"font-bold text-5xl",children:k[e]}):k[e]?(0,s.jsx)("span",{className:"text-green-600 text-4xl",children:"✅"}):(0,s.jsx)("span",{className:"text-muted-foreground text-4xl",children:"\uD83D\uDD52"})})]},e))})]})]})})};var C=a(1368),R=a(9601),K=a(4416);function A(e){let{...t}=e;return(0,s.jsx)(R.bL,{"data-slot":"dialog",...t})}function S(e){let{...t}=e;return(0,s.jsx)(R.ZL,{"data-slot":"dialog-portal",...t})}function _(e){let{className:t,...a}=e;return(0,s.jsx)(R.hJ,{"data-slot":"dialog-overlay",className:p("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function E(e){let{className:t,children:a,showCloseButton:r=!0,...o}=e;return(0,s.jsxs)(S,{"data-slot":"dialog-portal",children:[(0,s.jsx)(_,{}),(0,s.jsxs)(R.UC,{"data-slot":"dialog-content",className:p("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...o,children:[a,r&&(0,s.jsxs)(R.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,s.jsx)(K.A,{}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function Z(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"dialog-header",className:p("flex flex-col gap-2 text-center sm:text-left",t),...a})}function D(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"dialog-footer",className:p("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function z(e){let{className:t,...a}=e;return(0,s.jsx)(R.hE,{"data-slot":"dialog-title",className:p("text-lg leading-none font-semibold",t),...a})}let P=()=>{let[e,t]=(0,o.useState)(""),[a,l]=(0,o.useState)(""),[i,d]=(0,o.useState)(!1),[m,u]=(0,o.useState)(!1),[x,p]=(0,o.useState)(""),[h,j]=(0,o.useState)(""),[b,w]=(0,o.useState)(""),[N,k]=(0,o.useState)(""),[R,K]=(0,o.useState)(""),S=(0,r.useRouter)(),_=async()=>{if(!x.trim())return void w("Room Name is required");w("");let e=(0,C.A)().slice(0,6);localStorage.setItem("createdRoom",e),await (0,n.hZ)((0,n.KR)(c,"rooms/".concat(e)),{createdAt:Date.now(),name:x,password:h,members:{},votes:{},revealed:!1,question:""}),y.A.set("poker_room",e),y.A.set("poker_role","creator"),d(!1),p(""),j(""),S.push("/?room=".concat(e))},P=async()=>{if(!e.trim())return void l("Room ID is required");let t=(0,n.KR)(c,"rooms/".concat(e.trim()));try{let a=await (0,n.Jt)(t);if(!a.exists())return void l("Room not found");let s=a.val();s.password&&""!==s.password.trim()?(K(e.trim()),u(!0)):(y.A.set("poker_room",e.trim()),y.A.set("poker_role","guest"),S.push("/?room=".concat(e.trim())))}catch(e){console.error(e),l("Error while trying to join room")}},J=async()=>{let e=(0,n.KR)(c,"rooms/".concat(R));try{let t=await (0,n.Jt)(e);if(!t.exists()){l("Room not found"),u(!1);return}if(t.val().password!==N.trim())return void l("Incorrect password");y.A.set("poker_room",R),y.A.set("poker_role","guest"),S.push("/?room=".concat(R))}catch(e){console.error(e),l("Failed to verify password")}};return(0,s.jsxs)(g,{className:"px-5",children:[(0,s.jsx)("h3",{className:"font-medium text-center",children:"Welcome to Poll App"}),(0,s.jsxs)("div",{className:"space-y-4 max-w-sm w-full mx-auto",children:[(0,s.jsx)(f,{className:"w-full",onClick:()=>{d(!0)},children:"➕ Create Room"}),(0,s.jsx)("p",{className:"text-center",children:"or"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(v,{placeholder:"Enter Room ID",value:e,onChange:e=>{t(e.target.value),l("")},autoComplete:"off"}),(0,s.jsx)(f,{onClick:P,children:"Join"})]}),a&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:a}),(0,s.jsx)(A,{open:i,onOpenChange:d,children:(0,s.jsxs)(E,{children:[(0,s.jsx)(Z,{children:(0,s.jsx)(z,{children:"Create New Room"})}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(v,{placeholder:"Room Name",value:x,onChange:e=>p(e.target.value),autoComplete:"off"}),b&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:b})]}),(0,s.jsx)(v,{type:"text",placeholder:"Password (optional)",value:h,onChange:e=>j(e.target.value),autoComplete:"new-password"})]}),(0,s.jsxs)(D,{className:"pt-4",children:[(0,s.jsx)(f,{variant:"secondary",onClick:()=>{d(!1),p(""),j("")},children:"Cancel"}),(0,s.jsx)(f,{onClick:_,children:"Create"})]})]})}),(0,s.jsx)(A,{open:m,onOpenChange:u,children:(0,s.jsxs)(E,{children:[(0,s.jsx)(Z,{children:(0,s.jsx)(z,{children:"Enter Room Password"})}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(v,{type:"password",placeholder:"Password",value:N,onChange:e=>{k(e.target.value),l("")},autoComplete:"new-password"}),a&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:a})]}),(0,s.jsxs)(D,{className:"pt-4",children:[(0,s.jsx)(f,{variant:"secondary",onClick:()=>{u(!1),k(""),l("")},children:"Cancel"}),(0,s.jsx)(f,{onClick:J,children:"Join"})]})]})})]})]})},J=()=>{let e=(0,r.useSearchParams)().get("room"),t=(0,r.useRouter)(),a=y.A.get("poker_room");return(0,o.useEffect)(()=>{a&&t.push("/?room=".concat(a))},[a,t]),(0,s.jsx)("div",{children:e?(0,s.jsx)(k,{}):(0,s.jsx)(P,{})})}},9684:(e,t,a)=>{Promise.resolve().then(a.bind(a,4932))}},e=>{var t=t=>e(e.s=t);e.O(0,[507,654,441,684,358],()=>t(9684)),_N_E=e.O()}]);