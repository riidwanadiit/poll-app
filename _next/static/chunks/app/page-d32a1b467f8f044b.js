(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5691:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>O});var s=a(5155),r=a(2115);let o=function(e){let{Component:t,componentProps:a}=e;return(0,s.jsx)(t,{...null!=a?a:{}})};var n=a(5695),l=a(3915),i=a(1115);let c=(0,l.Dk)().length?(0,l.Dk)()[0]:(0,l.Wp)({apiKey:"AIzaSyCIEneI8y4NZSGE5AmCaVbOsHw7oy3nCBQ",authDomain:"poll-app-e3560.firebaseapp.com",databaseURL:"https://poll-app-e3560-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"poll-app-e3560",storageBucket:"poll-app-e3560.firebasestorage.app",messagingSenderId:"369998885005",appId:"1:369998885005:web:7fb3c89e5294ae6d56b2c4"}),d=(0,i.C3)(c);var m=a(9708),u=a(2085),x=a(2596),p=a(9688);function h(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,p.QP)((0,x.$)(t))}let f=(0,u.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function v(e){let{className:t,variant:a,size:r,asChild:o=!1,...n}=e,l=o?m.DX:"button";return(0,s.jsx)(l,{"data-slot":"button",className:h(f({variant:a,size:r,className:t})),...n})}function g(e){let{className:t,type:a,...r}=e;return(0,s.jsx)("input",{type:a,"data-slot":"input",className:h("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...r})}function j(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card",className:h("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}var b=a(968);function y(e){let{className:t,...a}=e;return(0,s.jsx)(b.b,{"data-slot":"label",className:h("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...a})}var w=a(7383),N=a(2919);let k=["1","2","3","5","8","11","13"],C=()=>{let e=(0,n.useSearchParams)().get("room")||"",t=(0,n.useRouter)(),a=w.A.get("poker_name"),o=w.A.get("poker_role"),[l,c]=(0,r.useState)(""),[m,u]=(0,r.useState)(""),[x,p]=(0,r.useState)(""),[h,f]=(0,r.useState)([]),[b,C]=(0,r.useState)({}),[R,K]=(0,r.useState)(!1),[A,S]=(0,r.useState)(k),[_,E]=(0,r.useState)(""),[Z,D]=(0,r.useState)(!1),[z,P]=(0,r.useState)(!1),[J,I]=(0,r.useState)(!1),[F,O]=(0,r.useState)(null),[V,q]=(0,r.useState)(!1),[T,L]=(0,r.useState)(""),[B,Q]=(0,r.useState)(""),U=(0,r.useCallback)(async()=>{let a=(0,i.KR)(d,"rooms/".concat(e)),s=(0,i.KR)(d,"rooms/".concat(e,"/members"));if(z){let t=(await (0,i.Jt)(s)).val();if(t){let a=Object.keys(t);await Promise.all(a.map(t=>(0,i.TF)((0,i.KR)(d,"rooms/".concat(e,"/members/").concat(t)))))}await (0,i.TF)(a)}else await (0,i.TF)((0,i.KR)(d,"rooms/".concat(e,"/members/").concat(l)));w.A.remove("poker_name"),w.A.remove("poker_room"),w.A.remove("poker_role"),t.replace("/")},[e,l,z,t]),W=(0,r.useCallback)(async()=>{if(!e)return;let t=(0,i.KR)(d,"rooms/".concat(e));if(!(await (0,i.Jt)(t)).exists()){alert("Room does not exist"),U();return}},[e,U]),X=async()=>{if(W(),!l.trim()||!e)return;let t=(0,i.KR)(d,"rooms/".concat(e,"/members/").concat(l));if((await (0,i.Jt)(t)).exists())return void alert("This name is already in use. Please choose another one.");await (0,i.hZ)(t,!0),w.A.set("poker_name",l),w.A.set("poker_room",e),w.A.set("poker_role","member"),D(!0)},G=async t=>{W(),l&&e&&!R&&(await (0,i.hZ)((0,i.KR)(d,"rooms/".concat(e,"/votes/").concat(l)),t),p(t))},H=async t=>{W(),u(t),await (0,i.hZ)((0,i.KR)(d,"rooms/".concat(e,"/question")),t)},M=async()=>{W(),await (0,i.hZ)((0,i.KR)(d,"rooms/".concat(e,"/revealed")),!0)},Y=async()=>{W(),await (0,i.yo)((0,i.KR)(d,"rooms/".concat(e)),{votes:null,revealed:!1})},$=async t=>{W(),e&&z&&t!==l&&await (0,i.TF)((0,i.KR)(d,"rooms/".concat(e,"/members/").concat(t)))},ee=async()=>{W();let t=_.split(",").map(e=>e.trim()).filter(Boolean);t.length>0&&await (0,i.yo)((0,i.KR)(d,"rooms/".concat(e)),{cardValues:t}).then(()=>E(""))},et=async()=>{if(W(),!e)return;let t=T.trim();await (0,i.yo)((0,i.KR)(d,"rooms/".concat(e)),{password:t||null}),q(!1),L(""),""==T&&O(null)};return(0,r.useEffect)(()=>{W()},[e,t,W]),(0,r.useEffect)(()=>{a&&c(a),"creator"===o&&P(!0),a&&o&&D(!0)},[a,o]),(0,r.useEffect)(()=>{if(!e)return;let t=(0,i.KR)(d,"rooms/".concat(e,"/members")),a=(0,i.KR)(d,"rooms/".concat(e,"/votes")),s=(0,i.KR)(d,"rooms/".concat(e,"/revealed")),r=(0,i.KR)(d,"rooms/".concat(e,"/question")),o=(0,i.KR)(d,"rooms/".concat(e,"/cardValues")),n=(0,i.KR)(d,"rooms/".concat(e,"/password"));if((0,i.Zy)(t,e=>{f(Object.keys(e.val()||{}))}),(0,i.Zy)(a,e=>{C(e.val()||{})}),(0,i.Zy)(s,e=>{K(!!e.val())}),(0,i.Zy)(r,e=>{u(e.val()||"")}),(0,i.Zy)(o,e=>{let t=e.val();t&&Array.isArray(t)?S(t):S(k)}),(0,i.Zy)(n,e=>{let t=e.val();O(null!=t?t:null)}),l){let t=(0,i.KR)(d,"rooms/".concat(e,"/creator"));(0,i.Jt)(t).then(e=>{e.exists()&&e.val()===l&&(P(!0),w.A.set("poker_role","creator"),D(!0))})}},[e,l]),(0,r.useEffect)(()=>{R||!l||b[l]||p("")},[R,b,l]),(0,r.useEffect)(()=>{if(!e||!l||!Z)return;let a=(0,i.KR)(d,"rooms/".concat(e,"/members/").concat(l)),s=(0,i.Zy)(a,e=>{e.exists()||(w.A.remove("poker_name"),w.A.remove("poker_room"),w.A.remove("poker_role"),t.replace("/"))});return()=>s()},[e,l,Z,t]),(0,r.useEffect)(()=>{if(!e)return;let t=(0,i.KR)(d,"rooms/".concat(e,"/members")),a=(0,i.KR)(d,"rooms/".concat(e,"/votes")),s=(0,i.KR)(d,"rooms/".concat(e,"/revealed")),r=(0,i.KR)(d,"rooms/".concat(e,"/question")),o=(0,i.KR)(d,"rooms/".concat(e,"/cardValues"));if((0,i.Zy)(t,e=>{f(Object.keys(e.val()||{}))}),(0,i.Zy)(a,e=>{C(e.val()||{})}),(0,i.Zy)(s,e=>{K(!!e.val())}),(0,i.Zy)(r,e=>{u(e.val()||"")}),(0,i.Zy)(o,e=>{let t=e.val();t&&Array.isArray(t)?S(t):S(k)}),l){let t=(0,i.KR)(d,"rooms/".concat(e,"/creator"));(0,i.Jt)(t).then(e=>{e.exists()&&e.val()===l&&(P(!0),w.A.set("poker_role","creator"),D(!0))})}},[e,l]),(0,r.useEffect)(()=>{if(!e)return;let t=(0,i.KR)(d,"rooms/".concat(e,"/roomName"));(0,i.Zy)(t,e=>{Q(e.val()||"")})},[e]),(0,s.jsx)("div",{children:(0,s.jsxs)(j,{className:"p-6 space-y-4 w-[90vw] mx-auto",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h2",{className:"font-bold text-lg flex gap-3 items-center",children:["Room: ",B," (",e,")"]}),(0,s.jsxs)("h2",{className:"font-bold text-lg flex gap-3 items-center",children:["Password:"," ",V?(0,s.jsxs)("div",{className:"flex gap-2 items-center font-medium text-sm",children:[(0,s.jsx)(g,{type:"text",value:T,onChange:e=>L(e.target.value),placeholder:"New Password",className:"w-[150px]"}),(0,s.jsx)(v,{onClick:et,className:"px-3 py-1 text-xs",variant:"default",children:"Save"}),(0,s.jsx)(v,{onClick:()=>{q(!1),L("")},className:"px-3 py-1 text-xs",variant:"outline",children:"Cancel"})]}):(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[F?(0,s.jsxs)("span",{className:"",children:[F," ",(0,s.jsx)(N.A,{className:"inline",width:12})]}):"-",z&&(0,s.jsx)(v,{onClick:()=>q(!0),size:"sm",variant:"ghost",className:"text-xs px-2 ",children:"Edit"}),z&&F&&(0,s.jsx)(v,{onClick:async()=>{await (0,i.yo)((0,i.KR)(d,"rooms/".concat(e)),{password:null}),O(null)},size:"sm",variant:"destructive",className:"text-xs px-2",children:"Delete"})]})]})]}),(0,s.jsx)(v,{onClick:U,variant:"destructive",className:"cursor-pointer",children:"Quit Room"})]}),(0,s.jsx)("h4",{className:"font-semibold mt-2",children:z?"Admin":l})]}),z&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(y,{children:"Poll Title"}),(0,s.jsx)(g,{placeholder:"Enter poll title",value:m,onChange:e=>H(e.target.value),className:"mb-0"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(y,{htmlFor:"cards",children:"Cards"}),J?(0,s.jsxs)("div",{className:"flex w-full items-center gap-2",children:[(0,s.jsx)(g,{id:"cards",value:_,defaultValue:A.join(", "),onChange:e=>E(e.target.value),placeholder:"e.g. 1,2,3,5,8,13",className:"grow"}),(0,s.jsx)(v,{onClick:()=>{Y(),ee(),I(!1)},className:"min-w-[200px]",children:"Update Cards"})]}):(0,s.jsxs)("div",{className:"flex w-full items-center gap-2",children:[(0,s.jsx)(g,{value:A.join(", "),className:"grow disabled:text-foreground",disabled:!0}),(0,s.jsx)(v,{onClick:()=>I(!0),className:"min-w-[200px]",children:"Edit Card"})]})]})]}),(0,s.jsx)("div",{children:R?(0,s.jsx)(v,{variant:"secondary",className:"w-full cursor-pointer",onClick:Y,children:"Reset"}):(0,s.jsx)(v,{onClick:M,disabled:0===Object.keys(b).length,className:"w-full cursor-pointer",children:"Reveal"})})]}),!Z&&!z&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(y,{htmlFor:"name",children:"Your Name"}),(0,s.jsx)(g,{id:"name",value:l,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"===e.key&&l.trim()&&X()},placeholder:"Enter your name"}),(0,s.jsx)(v,{className:"mt-2",onClick:X,disabled:!l.trim(),children:"Join Room"})]}),!z&&m&&(0,s.jsxs)("p",{className:"text-muted-foreground font-bold text-3xl",children:["\uD83D\uDCCC ",m]}),Z&&!z&&!R&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Select your card (you can change before reveal):"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:A.map(e=>(0,s.jsx)(v,{variant:b[l]===e?"default":"outline",onClick:()=>G(e),className:"cursor-pointer w-[75px] h-auto aspect-[3/4]",children:e},e))})]}),x&&!R&&(0,s.jsxs)("p",{className:"text-green-700 font-medium",children:["✅ Vote recorded as ",(0,s.jsx)("strong",{children:x})]}),(0,s.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,s.jsx)("h3",{className:"font-semibold",children:"Members"}),0===h.length?(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"No members yet"}):(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:h.map(e=>(0,s.jsxs)(j,{className:"relative",children:[z&&e!==l&&(0,s.jsx)(v,{variant:"destructive",className:"p-0 w-[20px] h-[20px] text-[10px] absolute right-2 top-2 cursor-pointer","aria-label":"Kick ".concat(e),onClick:()=>$(e),children:"X"}),(0,s.jsx)("h4",{className:"text-center font-semibold",children:e}),(0,s.jsx)("div",{className:"w-full min-h-[7rem] flex items-center justify-center",children:R&&b[e]?(0,s.jsx)("span",{className:"font-bold text-5xl",children:b[e]}):b[e]?(0,s.jsx)("span",{className:"text-green-600 text-4xl",children:"✅"}):(0,s.jsx)("span",{className:"text-muted-foreground text-4xl",children:"\uD83D\uDD52"})})]},e))})]})]})})};var R=a(1368),K=a(9601),A=a(4416);function S(e){let{...t}=e;return(0,s.jsx)(K.bL,{"data-slot":"dialog",...t})}function _(e){let{...t}=e;return(0,s.jsx)(K.ZL,{"data-slot":"dialog-portal",...t})}function E(e){let{className:t,...a}=e;return(0,s.jsx)(K.hJ,{"data-slot":"dialog-overlay",className:h("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function Z(e){let{className:t,children:a,showCloseButton:r=!0,...o}=e;return(0,s.jsxs)(_,{"data-slot":"dialog-portal",children:[(0,s.jsx)(E,{}),(0,s.jsxs)(K.UC,{"data-slot":"dialog-content",className:h("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...o,children:[a,r&&(0,s.jsxs)(K.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,s.jsx)(A.A,{}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function D(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"dialog-header",className:h("flex flex-col gap-2 text-center sm:text-left",t),...a})}function z(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"dialog-footer",className:h("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function P(e){let{className:t,...a}=e;return(0,s.jsx)(K.hE,{"data-slot":"dialog-title",className:h("text-lg leading-none font-semibold",t),...a})}let J=()=>{let[e,t]=(0,r.useState)(""),[a,o]=(0,r.useState)(""),[l,c]=(0,r.useState)(!1),[m,u]=(0,r.useState)(!1),[x,p]=(0,r.useState)(""),[h,f]=(0,r.useState)(""),[b,y]=(0,r.useState)(""),[N,k]=(0,r.useState)(""),[C,K]=(0,r.useState)(""),A=(0,n.useRouter)(),_=async()=>{if(!x.trim())return void y("Room Name is required");y("");let e=(0,R.A)().slice(0,6);localStorage.setItem("createdRoom",e),await (0,i.hZ)((0,i.KR)(d,"rooms/".concat(e)),{createdAt:Date.now(),name:x,password:h,members:{},votes:{},revealed:!1,question:""}),w.A.set("poker_room",e),w.A.set("poker_role","creator"),c(!1),p(""),f(""),A.push("/?room=".concat(e))},E=async()=>{if(!e.trim())return void o("Room ID is required");let t=(0,i.KR)(d,"rooms/".concat(e.trim()));try{let a=await (0,i.Jt)(t);if(!a.exists())return void o("Room not found");let s=a.val();s.password&&""!==s.password.trim()?(K(e.trim()),u(!0)):(w.A.set("poker_room",e.trim()),w.A.set("poker_role","guest"),A.push("/?room=".concat(e.trim())))}catch(e){console.error(e),o("Error while trying to join room")}},J=async()=>{let e=(0,i.KR)(d,"rooms/".concat(C));try{let t=await (0,i.Jt)(e);if(!t.exists()){o("Room not found"),u(!1);return}if(t.val().password!==N.trim())return void o("Incorrect password");w.A.set("poker_room",C),w.A.set("poker_role","guest"),A.push("/?room=".concat(C))}catch(e){console.error(e),o("Failed to verify password")}};return(0,s.jsxs)(j,{className:"px-5",children:[(0,s.jsx)("h3",{className:"font-medium text-center",children:"Welcome to Poll App"}),(0,s.jsxs)("div",{className:"space-y-4 max-w-sm w-full mx-auto",children:[(0,s.jsx)(v,{className:"w-full",onClick:()=>{c(!0)},children:"➕ Create Room"}),(0,s.jsx)("p",{className:"text-center",children:"or"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(g,{placeholder:"Enter Room ID",value:e,onChange:e=>{t(e.target.value),o("")},autoComplete:"off"}),(0,s.jsx)(v,{onClick:E,children:"Join"})]}),a&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:a}),(0,s.jsx)(S,{open:l,onOpenChange:c,children:(0,s.jsxs)(Z,{children:[(0,s.jsx)(D,{children:(0,s.jsx)(P,{children:"Create New Room"})}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(g,{placeholder:"Room Name",value:x,onChange:e=>p(e.target.value),autoComplete:"off"}),b&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:b})]}),(0,s.jsx)(g,{type:"text",placeholder:"Password (optional)",value:h,onChange:e=>f(e.target.value),autoComplete:"new-password"})]}),(0,s.jsxs)(z,{className:"pt-4",children:[(0,s.jsx)(v,{variant:"secondary",onClick:()=>{c(!1),p(""),f("")},children:"Cancel"}),(0,s.jsx)(v,{onClick:_,children:"Create"})]})]})}),(0,s.jsx)(S,{open:m,onOpenChange:u,children:(0,s.jsxs)(Z,{children:[(0,s.jsx)(D,{children:(0,s.jsx)(P,{children:"Enter Room Password"})}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(g,{type:"password",placeholder:"Password",value:N,onChange:e=>{k(e.target.value),o("")},autoComplete:"new-password"}),a&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:a})]}),(0,s.jsxs)(z,{className:"pt-4",children:[(0,s.jsx)(v,{variant:"secondary",onClick:()=>{u(!1),k(""),o("")},children:"Cancel"}),(0,s.jsx)(v,{onClick:J,children:"Join"})]})]})})]})]})},I=()=>{let e=(0,n.useSearchParams)().get("room"),t=(0,n.useRouter)(),a=w.A.get("poker_room");return(0,r.useEffect)(()=>{a&&t.push("/?room=".concat(a))},[a,t]),(0,s.jsx)("div",{children:e?(0,s.jsx)(C,{}):(0,s.jsx)(J,{})})};function F(){return(0,s.jsx)("main",{className:"min-h-screen flex items-center justify-center p-8",children:(0,s.jsx)(o,{Component:I})})}function O(){return(0,s.jsx)(r.Suspense,{fallback:(0,s.jsx)("div",{children:"Loading..."}),children:(0,s.jsx)(F,{})})}},5951:(e,t,a)=>{Promise.resolve().then(a.bind(a,5691))}},e=>{var t=t=>e(e.s=t);e.O(0,[507,654,441,684,358],()=>t(5951)),_N_E=e.O()}]);